
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ANOVA &#8212; From Statistics to Statistical Learning</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://integzz.github.io/excss-stats/basics/05-ANOVA.html" />
    <link rel="shortcut icon" href="../_static/logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Hypothesis Testing" href="04-Hypothesis-Testing.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">From Statistics to Statistical Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   From Statistics to Statistical Learning
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  HandsON
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../handson/02-data-processing.html">
   Data Processing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../handson/03-classification.html">
   Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../handson/04-linear-models.html">
   Linear Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../handson/05-support-vector-machines.html">
   Support Vector Machines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../handson/06-decision-trees.html">
   Decision Trees
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../handson/07-ensemble-learning.html">
   Ensemble Learning
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Statistics
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01-Descriptive-Statistics.html">
   Descriptive Statistics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02-Probability-Review.html">
   Basic Concepts Refresh
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-Parameter-Estimation.html">
   Parameter Estimation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04-Hypothesis-Testing.html">
   Hypothesis Testing
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   ANOVA
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/basics/05-ANOVA.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/integzz/excss-stats/"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/integzz/excss-stats//issues/new?title=Issue%20on%20page%20%2Fbasics/05-ANOVA.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/integzz/excss-stats/edit/master/basics/05-ANOVA.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/integzz/excss-stats/master?urlpath=lab/tree/basics/05-ANOVA.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/integzz/excss-stats/blob/master/basics/05-ANOVA.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   ANOVA
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#one-way-analysis-of-variance-font">
   One-Way Analysis of Variance
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#an-example-of-population-height">
     An Example of Population Height
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-simulation-view-of-factors-that-affects-f-statistic">
     A Simulation View of Factors That Affects
     <span class="math notranslate nohighlight">
      \(F\)
     </span>
     -Statistic
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lsd-confidence-intervals">
     LSD Confidence Intervals
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#chi-squared-goodness-of-fit-test">
   Chi-Squared Goodness-of-Fit Test
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="anova">
<h1>ANOVA<a class="headerlink" href="#anova" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">special</span>
</pre></div>
</div>
</div>
</div>
<p>Simply speaking, the <strong>Analysis of Variance</strong> (ANOVA) is a technique of comparing means of multiple<span class="math notranslate nohighlight">\((\geq 3)\)</span> populations, the name derives from the way how calculations are performed.</p>
<p>For example, a common hypotheses of ANOVA are</p>
<div class="math notranslate nohighlight">
\[\begin{split}
H_0:\quad μ_1=μ_2=μ_3=⋅s=μ_n\\
H_1:\quad \text{At least two means differ}
\end{split}\]</div>
<p>The first doubt pops up in mind: why aren’t we using same old <span class="math notranslate nohighlight">\(t\)</span>-tests such that</p>
<div class="math notranslate nohighlight">
\[\begin{split}
H_0: μ_1=μ_2 \qquad H_0: μ_1=μ_3 \qquad H_0: μ_1=μ_4 \qquad H_0:\quad μ_2=μ_3\quad⋅s\\
H_1: μ_1\neqμ_2 \qquad H_1: μ_1\neqμ_3\qquad  H_1:μ_1\neqμ_4 \qquad H_1:\quad μ_2\neqμ_3\quad⋅s\\
\end{split}\]</div>
<p>and so on so forth, till exhaustion of all pairwise combination.</p>
<p>Apparently, the number of <span class="math notranslate nohighlight">\(t\)</span>-tests will be as large as <span class="math notranslate nohighlight">\({n \choose 2} \)</span> where <span class="math notranslate nohighlight">\(n\)</span> is the number of populations. If there are <span class="math notranslate nohighlight">\(5\)</span> populations, then we have to test <span class="math notranslate nohighlight">\({5 \choose 2}=10\)</span> pairs. With <span class="math notranslate nohighlight">\(95\%\)</span> confidence level, <span class="math notranslate nohighlight">\(10\)</span> <span class="math notranslate nohighlight">\(t\)</span>-tests would cut back confidence level dramatically to <span class="math notranslate nohighlight">\(95\%^{10}=59.8\%\)</span>, which also means the probability of <em>type I</em> error would be around <span class="math notranslate nohighlight">\(40\%\)</span>.</p>
<p>A sidenote, econometric ANOVA is a standard practice that all statistical packages automatically print, however the terminologies in statistics are peculiar to econometric practioners, but still semantically sensible that will be clarified in later discussion.</p>
</div>
<div class="section" id="one-way-analysis-of-variance-font">
<h1>One-Way Analysis of Variance </font><a class="headerlink" href="#one-way-analysis-of-variance-font" title="Permalink to this headline">¶</a></h1>
<p>If samples are independently drawn from populations, the technique of ANOVA is called <strong>One-Way ANOVA</strong>. The statistic that measures the proximity of the sample means to each other is called <strong>sum of squares for treatments</strong> (SST). The terminology <em>treatment</em> was introduced in 1920s when conducting ANOVA on different treatments of fertilisers for testing potential yields. For instance, an agronomist can sample three different corn yields applied with three different fertilisers.</p>
<p>The sum of squares for treatments (SST) represents the <strong>between-treatment variation</strong>, the mathematical form is
$<span class="math notranslate nohighlight">\(
SST=\sum_{i=1}^kn_i(\bar{x}_i-\bar{\bar{x}})^2
\)</span><span class="math notranslate nohighlight">\(
where \)</span>n_i<span class="math notranslate nohighlight">\( is the sample size of treatments \)</span>i<span class="math notranslate nohighlight">\(, \)</span>\bar{\bar{x}}<span class="math notranslate nohighlight">\( is the grand mean, i.e. the _mean of the sample means_, \)</span>k$ is the number of treatments.</p>
<p>There are also <strong>within-treatments variations</strong> which is denoted by <strong>sum of squares for error</strong> (SSE), it measures the deviation of all observations from its sample mean.
$<span class="math notranslate nohighlight">\(
SSE=\sum_{i=1}^k\sum_{j=1}^{n_i}(x_{ij}-\bar{x}_i)^2=\sum_{j=1}^{n_1}(x_{j1}-\bar{x}_1)^2+\sum_{j=1}^{n_2}(x_{j2}-\bar{x}_2)^2+⋅s+\sum_{j=1}^{n_k}(x_{jk}-\bar{x}_k)^2
\)</span><span class="math notranslate nohighlight">\(
If we divide \)</span>SSE<span class="math notranslate nohighlight">\( by \)</span>(n_i-1)<span class="math notranslate nohighlight">\(, i.e. the degree of freedom of each sample, \)</span>SSE<span class="math notranslate nohighlight">\( can be rewritten more consicely as
\)</span><span class="math notranslate nohighlight">\(
SSE =(n_1-1)s_1^2+(n_2-1)s_2^2+⋅s+(n_k-1)s_k^2
\)</span><span class="math notranslate nohighlight">\(
where \)</span>s_i^2<span class="math notranslate nohighlight">\( is the sample variance of sample \)</span>i$.</p>
<p>In order to construct <span class="math notranslate nohighlight">\(F\)</span>-statistic, we need to introduce two more statistics, the first one is <strong>Mean Square for Treatments</strong> (MST)
$<span class="math notranslate nohighlight">\(
MST=\frac{SST}{k-1}
\)</span><span class="math notranslate nohighlight">\(
And the second one is **Mean Square for Error** (MSE)
\)</span><span class="math notranslate nohighlight">\(
MSE=\frac{SSE}{n-k}
\)</span><span class="math notranslate nohighlight">\(
Join them together, an \)</span>F<span class="math notranslate nohighlight">\(-statistic is constructed
\)</span><span class="math notranslate nohighlight">\(
F=\frac{MST}{MSE}
\)</span>$</p>
<p>There are three assumptions for an ANOVA test to be valid.</p>
<ol>
<li><i>Each sample is independent to each other.</i></li>
<li><i>Each sample is drawn from a normally distributed population.</i></li>
<li><i>Population standard deviation are homoskedastic, i.e. constant variance.</i></li>
</ol>
Though in practice you might frequently encounter violation of the assumptions, you should be fully aware of the potentially misleading interpretation of the test results.<p>If <span class="math notranslate nohighlight">\(SST\)</span> is large, then so is <span class="math notranslate nohighlight">\(MST\)</span>, more likely to produce a larger <span class="math notranslate nohighlight">\(F\)</span>-statistic, then a higher probability to reject null hypothesis, the rejection rule is
$<span class="math notranslate nohighlight">\(
F&gt;F_{\alpha, k-1, n-k}
\)</span>$</p>
<p>Critical value <span class="math notranslate nohighlight">\(F_{\alpha, k-1, n-k}\)</span> can be returned by <code class="docutils literal notranslate"><span class="pre">scipy.stats.f.ppf()</span></code>. For instance, the number of treatment is <span class="math notranslate nohighlight">\(4\)</span>, sum of sample sizes is <span class="math notranslate nohighlight">\(342\)</span>, with <span class="math notranslate nohighlight">\(95\%\)</span> confidence level the crtical value is</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">328</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.6321415117354894
</pre></div>
</div>
</div>
</div>
<p>The widely-known variance decomposition equation is
$<span class="math notranslate nohighlight">\(
SS(Total)=SST+SSE
\)</span><span class="math notranslate nohighlight">\(
Mathematically
\)</span><span class="math notranslate nohighlight">\(
\sum_{i=1}^k \sum_{j=1}^{n_i}(x_{ij}-\bar{\bar{x}})^2= \sum_{i=1}^kn_i(\bar{x}_i-\bar{\bar{x}})^2+(n_1-1)s_1^2+(n_2-1)s_2^2+⋅s+(n_k-1)s_k^2
\)</span>$</p>
<div class="section" id="an-example-of-population-height">
<h2>An Example of Population Height<a class="headerlink" href="#an-example-of-population-height" title="Permalink to this headline">¶</a></h2>
<p>Here is a simple example, we will use three samples of male heights to perform an ANOVA analysis. The hypotheses are
$<span class="math notranslate nohighlight">\(
H_0: μ_1=μ_2=μ_3\\
H_1: \text{At least two means differ}\\
\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;data/heights.xlsx&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Japanese</th>
      <th>Dutch</th>
      <th>Danish</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>161.783130</td>
      <td>187.726286</td>
      <td>174.746213</td>
    </tr>
    <tr>
      <th>1</th>
      <td>145.329934</td>
      <td>179.338741</td>
      <td>174.133579</td>
    </tr>
    <tr>
      <th>2</th>
      <td>174.569597</td>
      <td>176.566656</td>
      <td>178.966745</td>
    </tr>
    <tr>
      <th>3</th>
      <td>160.003162</td>
      <td>184.570245</td>
      <td>179.335222</td>
    </tr>
    <tr>
      <th>4</th>
      <td>162.242898</td>
      <td>184.056181</td>
      <td>167.497992</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Here are ANOVA formulae typed in a verbatim manner.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dutch_mean</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">japanese_mean</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">danish_mean</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">grand_mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">dutch_mean</span><span class="o">+</span><span class="n">japanese_mean</span><span class="o">+</span><span class="n">danish_mean</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>

<span class="n">SST</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">japanese_mean</span><span class="o">-</span><span class="n">grand_mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>\
      <span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">dutch_mean</span><span class="o">-</span><span class="n">grand_mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>\
      <span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">danish_mean</span><span class="o">-</span><span class="n">grand_mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="n">MST</span> <span class="o">=</span> <span class="n">SST</span><span class="o">/</span><span class="mi">2</span>

<span class="n">SSE</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
      <span class="o">+</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
      <span class="o">+</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">])</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">MSE</span> <span class="o">=</span> <span class="n">SSE</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="p">)</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">MST</span><span class="o">/</span><span class="n">MSE</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;F-statistic: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">F</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>F-statistic: 37.96057544749984
p-value: 2.3363533330211794e-12
</pre></div>
</div>
</div>
</div>
<p>The test results favours the alternative hypothesis overwhelmingly.</p>
<p>Before we close the case, let’s exam the sample variance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Japanese sample variance: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Danish sample variance: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dutch sample variance: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Japanese sample variance: 145.93369676074872
Danish sample variance: 20.108195066929262
Dutch sample variance: 15.844843124694973
</pre></div>
</div>
</div>
</div>
<p>Apparently they violate on of assumptions of ANOVA, therefore cautious must be taken when interpreting the results, though we firmly know the mean heights in these three countries are different.</p>
</div>
<div class="section" id="a-simulation-view-of-factors-that-affects-f-statistic">
<h2>A Simulation View of Factors That Affects <span class="math notranslate nohighlight">\(F\)</span>-Statistic<a class="headerlink" href="#a-simulation-view-of-factors-that-affects-f-statistic" title="Permalink to this headline">¶</a></h2>
<p>Rather than stating that the <span class="math notranslate nohighlight">\(F\)</span>-tests might be invalid due to violation of critial assumptions, we’ll step further to generate simulations to show how various parameters affect <span class="math notranslate nohighlight">\(F\)</span>-statistics.</p>
<p>The plotting codes are messy, thus hidden in the <code class="docutils literal notranslate"><span class="pre">plot_material.anova_plot()</span></code>, there 9 groups of charts, e.g. titled as ‘Simulation X’, each group has a two axes surrounded by a black frame.</p>
<p>We will repetitively draw samples from three populations, each with its own parameters <span class="math notranslate nohighlight">\(μ\)</span>, <span class="math notranslate nohighlight">\(σ\)</span> and <span class="math notranslate nohighlight">\(N\)</span>, i.e. population mean, population variance and sample size. Each draw can be computed an <span class="math notranslate nohighlight">\(F\)</span>-statistic, we perform this simuation in a loop of <span class="math notranslate nohighlight">\(1000\)</span> rounds, then we plot the fequency distribution of <span class="math notranslate nohighlight">\(F\)</span>-statistic on the upper axes, and the <span class="math notranslate nohighlight">\(p\)</span>-value on the lower axes.</p>
<p>And the red vertical line is the critical value of <span class="math notranslate nohighlight">\(F\)</span>-statistic, any test results fall to the right-side of the red line shall conclude a rejection to the null hypothesis.</p>
<p>For instance, the simulation <span class="math notranslate nohighlight">\(1\)</span> has <span class="math notranslate nohighlight">\(μ_1=3, μ_2=6, μ_3 = 9\)</span>, it surely indicate a large <span class="math notranslate nohighlight">\(F\)</span>-statistic, because larger <span class="math notranslate nohighlight">\(MST\)</span>, however we could still see yet a smaller amount of <span class="math notranslate nohighlight">\(F\)</span>’s that fall short than critical value. The distributions of corresponding p-values are also plotted under the <span class="math notranslate nohighlight">\(F\)</span>-statistic distribution.</p>
<p>The simulation <span class="math notranslate nohighlight">\(2\)</span> has <span class="math notranslate nohighlight">\(μ_1=3, μ_2=3.1, μ_3 = 2.9\)</span>, unless the standard deviation are dominantly trivial, we won’t expect a high chance of rejecting null hypothesis, and that’s also what the chart shows.</p>
<p>The difference between simulation <span class="math notranslate nohighlight">\(2\)</span> and <span class="math notranslate nohighlight">\(3\)</span> is the <span class="math notranslate nohighlight">\(σ\)</span>, apparently the latter one violates the assumption of homoskedasticity, and the <span class="math notranslate nohighlight">\(σ\)</span>’s mainly are larger than Simulation <span class="math notranslate nohighlight">\(1\)</span>, thus it pushes more distributions of <span class="math notranslate nohighlight">\(F\)</span>-statistic to the left side of <span class="math notranslate nohighlight">\(F_c\)</span>, i.e. fail to reject null.</p>
<p>The simulation <span class="math notranslate nohighlight">\(4\)</span> complies with assumption of homoskedasticity, and due to variaous <span class="math notranslate nohighlight">\(μ\)</span>’s, presumably we would expect a higher volume of rejection of null hypothesis. Visually, yet a large amount of tests fail to reject, possibly due to relative larger standard deviations.</p>
<p>The simulation <span class="math notranslate nohighlight">\(5\)</span> and <span class="math notranslate nohighlight">\(6\)</span> privide some interesting insight, when the sample size are small such as <span class="math notranslate nohighlight">\(n=10\)</span> and relatively large <span class="math notranslate nohighlight">\(σ\)</span> would result in a predominant amout of false negative. The straightforward remedy is to increase the sample size as in the simulation <span class="math notranslate nohighlight">\(6\)</span>.</p>
<p>You can experiment on parameters of simulation <span class="math notranslate nohighlight">\(7\)</span>, <span class="math notranslate nohighlight">\(8\)</span> and <span class="math notranslate nohighlight">\(9\)</span>.</p>
</div>
<div class="section" id="lsd-confidence-intervals">
<h2>LSD Confidence Intervals<a class="headerlink" href="#lsd-confidence-intervals" title="Permalink to this headline">¶</a></h2>
<p>If you have rejected the null hypothesis, but still need further investigation into which treatments deviate from the rest, you need one technique to identify the source of discrepancy. Here’s the example of the technique.</p>
<p>The same height example, there is one more column of Finnish in the sheet 2. Let’s import the sheet 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;data/heights.xlsx&#39;</span><span class="p">,</span> <span class="s1">&#39;Sheet2&#39;</span><span class="p">)</span>
<span class="n">df2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Japanese</th>
      <th>Dutch</th>
      <th>Danish</th>
      <th>Finnish</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>161.783130</td>
      <td>187.726286</td>
      <td>174.746213</td>
      <td>175.855378</td>
    </tr>
    <tr>
      <th>1</th>
      <td>145.329934</td>
      <td>179.338741</td>
      <td>174.133579</td>
      <td>175.513979</td>
    </tr>
    <tr>
      <th>2</th>
      <td>174.569597</td>
      <td>176.566656</td>
      <td>178.966745</td>
      <td>173.363995</td>
    </tr>
    <tr>
      <th>3</th>
      <td>160.003162</td>
      <td>184.570245</td>
      <td>179.335222</td>
      <td>178.515200</td>
    </tr>
    <tr>
      <th>4</th>
      <td>162.242898</td>
      <td>184.056181</td>
      <td>167.497992</td>
      <td>173.108095</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The method we are going to introduce is called <strong>Fisher’s Least Significant Difference</strong> (LSD), mathematically as
$<span class="math notranslate nohighlight">\(
LSD= t_{\alpha/2}\sqrt{MSE\bigg(\frac{1}{n_i}+\frac{1}{n_j}\bigg)}
\)</span><span class="math notranslate nohighlight">\(
where degree of freedom is \)</span>n_1+n_2-2<span class="math notranslate nohighlight">\(, and the confidence interval estimator of mean difference is
\)</span><span class="math notranslate nohighlight">\(
(\bar{x}_i-\bar{x}_j)\pm t_{\alpha/2}\sqrt{MSE\bigg(\frac{1}{n_i}+\frac{1}{n_j}\bigg)}
\)</span>$</p>
<p>First, calculate the <span class="math notranslate nohighlight">\(MSE\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dutch_mean</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">japanese_mean</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">danish_mean</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">finnish_mean</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Finnish&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">grand_mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">dutch_mean</span> <span class="o">+</span> <span class="n">japanese_mean</span> <span class="o">+</span> <span class="n">danish_mean</span> <span class="o">+</span> <span class="n">finnish_mean</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span>

<span class="n">SSE</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
    <span class="o">+</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
    <span class="o">+</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
    <span class="o">+</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Finnish&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Finnish&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span>
    <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Finnish&#39;</span><span class="p">])</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">MSE</span> <span class="o">=</span> <span class="n">SSE</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <span class="math notranslate nohighlight">\(LSD\)</span> statistic are intended for each pair of treatments.</p>
<p><span class="math notranslate nohighlight">\(4\)</span> groups means there are <span class="math notranslate nohighlight">\(\binom{4}{2}=6\)</span> pairs to test. Let’s write a simple function of <span class="math notranslate nohighlight">\(LSD\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lsd</span><span class="p">(</span><span class="n">sig_level</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sig_level</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">n1</span><span class="o">+</span><span class="n">n2</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">MSE</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">n2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jadu</span> <span class="o">=</span> <span class="n">japanese_mean</span> <span class="o">-</span> <span class="n">dutch_mean</span>
<span class="n">jada</span> <span class="o">=</span> <span class="n">japanese_mean</span> <span class="o">-</span> <span class="n">danish_mean</span>
<span class="n">jafi</span> <span class="o">=</span> <span class="n">japanese_mean</span> <span class="o">-</span> <span class="n">finnish_mean</span>
<span class="n">duda</span> <span class="o">=</span> <span class="n">dutch_mean</span> <span class="o">-</span> <span class="n">danish_mean</span>
<span class="n">dufi</span> <span class="o">=</span> <span class="n">dutch_mean</span> <span class="o">-</span> <span class="n">finnish_mean</span>
<span class="n">dafi</span> <span class="o">=</span> <span class="n">danish_mean</span> <span class="o">-</span> <span class="n">finnish_mean</span>

<span class="n">jadu_lsd_low</span> <span class="o">=</span> <span class="n">jadu</span> <span class="o">-</span> <span class="n">lsd</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">]))</span>
<span class="n">jadu_lsd_high</span> <span class="o">=</span> <span class="n">jadu</span> <span class="o">+</span> <span class="n">lsd</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">]))</span>

<span class="n">jada_lsd_low</span> <span class="o">=</span> <span class="n">jada</span> <span class="o">-</span> <span class="n">lsd</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">]))</span>
<span class="n">jada_lsd_high</span> <span class="o">=</span> <span class="n">jada</span> <span class="o">+</span> <span class="n">lsd</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">]))</span>

<span class="n">jafi_lsd_low</span> <span class="o">=</span> <span class="n">jafi</span> <span class="o">-</span> <span class="n">lsd</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Finnish&#39;</span><span class="p">]))</span>
<span class="n">jafi_lsd_high</span> <span class="o">=</span> <span class="n">jafi</span> <span class="o">+</span> <span class="n">lsd</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Japanese&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Finnish&#39;</span><span class="p">]))</span>

<span class="n">duda_lsd_low</span> <span class="o">=</span> <span class="n">duda</span> <span class="o">-</span> <span class="n">lsd</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">]))</span>
<span class="n">duda_lsd_high</span> <span class="o">=</span> <span class="n">duda</span> <span class="o">+</span> <span class="n">lsd</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">]))</span>

<span class="n">dufi_lsd_low</span> <span class="o">=</span> <span class="n">dufi</span> <span class="o">-</span> <span class="n">lsd</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Finnish&#39;</span><span class="p">]))</span>
<span class="n">dufi_lsd_high</span> <span class="o">=</span> <span class="n">dufi</span> <span class="o">+</span> <span class="n">lsd</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Dutch&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Finnish&#39;</span><span class="p">]))</span>

<span class="n">dafi_lsd_low</span> <span class="o">=</span> <span class="n">dafi</span> <span class="o">-</span> <span class="n">lsd</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Finnish&#39;</span><span class="p">]))</span>
<span class="n">dafi_lsd_high</span> <span class="o">=</span> <span class="n">dafi</span> <span class="o">+</span> <span class="n">lsd</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="n">MSE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Danish&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Finnish&#39;</span><span class="p">]))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Comparison, Point Estimate, Lower Bound, Upper Bound&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Japanese - Dutch   : </span><span class="si">{:.4f}</span><span class="s1">,    </span><span class="si">{:.4f}</span><span class="s1">,     </span><span class="si">{:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">jadu</span><span class="p">,</span> <span class="n">jadu_lsd_low</span><span class="p">,</span> <span class="n">jadu_lsd_high</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Japanese - Danish  : </span><span class="si">{:.4f}</span><span class="s1">,    </span><span class="si">{:.4f}</span><span class="s1">,     </span><span class="si">{:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">jada</span><span class="p">,</span> <span class="n">jada_lsd_low</span><span class="p">,</span> <span class="n">jada_lsd_high</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Japanese - Finnish : </span><span class="si">{:.4f}</span><span class="s1">,    </span><span class="si">{:.4f}</span><span class="s1">,     </span><span class="si">{:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">jafi</span><span class="p">,</span> <span class="n">jafi_lsd_low</span><span class="p">,</span> <span class="n">jafi_lsd_high</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dutch - Danish     : </span><span class="si">{:.4f}</span><span class="s1">,       </span><span class="si">{:.4f}</span><span class="s1">,       </span><span class="si">{:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">duda</span><span class="p">,</span> <span class="n">duda_lsd_low</span><span class="p">,</span> <span class="n">duda_lsd_high</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dutch - Finnish    : </span><span class="si">{:.4f}</span><span class="s1">,       </span><span class="si">{:.4f}</span><span class="s1">,       </span><span class="si">{:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">dufi</span><span class="p">,</span> <span class="n">dufi_lsd_low</span><span class="p">,</span> <span class="n">dufi_lsd_high</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Danish - Finnish   : </span><span class="si">{:.4f}</span><span class="s1">,    </span><span class="si">{:.4f}</span><span class="s1">,      </span><span class="si">{:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">dafi</span><span class="p">,</span> <span class="n">dafi_lsd_low</span><span class="p">,</span> <span class="n">dafi_lsd_high</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Comparison, Point Estimate, Lower Bound, Upper Bound
Japanese - Dutch   : -17.7116,    -21.3998,     -14.0233
Japanese - Danish  : -12.2196,    -15.9078,     -8.5313
Japanese - Finnish : -12.8530,    -16.5413,     -9.1648
Dutch - Danish     : 5.4920,       1.8038,       9.1803
Dutch - Finnish    : 4.8585,       1.1703,       8.5468
Danish - Finnish   : -0.6335,    -4.3217,      3.0548
</pre></div>
</div>
</div>
</div>
<p>Point estimate is straightforward to interprete, if the estimate is further away from <span class="math notranslate nohighlight">\(0\)</span>, we have stronger evidence that two sample means differ.</p>
<p>But to give a clear statistical inference with <span class="math notranslate nohighlight">\(\alpha\)</span> significance level, we should look at confidence interval. If the interval excludes <span class="math notranslate nohighlight">\(0\)</span>, we could conclude a rejection of <span class="math notranslate nohighlight">\(μ_i=μ_j\)</span>. In our example, the only fail to rejection is between Danish and Finnish, it means their male heights are largely indifferentiable.</p>
<p>Therefore we conclude that the <span class="math notranslate nohighlight">\(MST\)</span> is mostly contributed by Japanese compared to other countries.</p>
</div>
</div>
<div class="section" id="chi-squared-goodness-of-fit-test">
<h1>Chi-Squared Goodness-of-Fit Test<a class="headerlink" href="#chi-squared-goodness-of-fit-test" title="Permalink to this headline">¶</a></h1>
<p>This is the last topic of the this tutorial session. Let’s walk through an example, then you will be able to grasp the essence of <strong>chi-squared goodness-of-fit test</strong>.</p>
<p>There are three marksman, who are competing shooting beer bottles hanging on a tree <span class="math notranslate nohighlight">\(300m\)</span> away, according to their historical records. Here is their hitting rates.</p>
<table style="width:30%; text-align:center;font-size: 120%">
  <tr>
    <th>Marksman</th>
    <th>Hitting Rate</th>
  </tr>
  <tr>
    <td>A</td>
    <td>$24\%$</td>
  </tr>
  <tr>
    <td>B</td>
    <td>$40\%$</td>
  </tr>
   <tr>
    <td>C</td>
    <td>$36\%$</td>
  </tr>
</table><p>Apparently <span class="math notranslate nohighlight">\(24\%+40\%+36\%=1\)</span>, which is a feature of <strong>multinomial experiment</strong>.</p>
<p>In order to improve performance, Marksman A attended a hunter training camp, then they agree to compete again. They take turn to shoot and will stop until the 500th bottle is shot. Here is the result.</p>
<table style="width:30%; text-align:center;font-size: 120%">
  <tr>
    <th>Marksman</th>
    <th>Bottles</th>
  </tr>
  <tr>
    <td>A</td>
    <td>$142$</td>
  </tr>
  <tr>
    <td>B</td>
    <td>$187$</td>
  </tr>
   <tr>
    <td>C</td>
    <td>$172$</td>
  </tr>
</table><p>We would like to know if Marksman A has improved which also causes the hitting rate changes. The null hypothesis is specified as
$<span class="math notranslate nohighlight">\(
H_0: p_1=24\%, p_2 = 40\%, p_3=36\%\\
H_1: \text{At least one \)</span>p_i<span class="math notranslate nohighlight">\( is not equal to its specified value}
\)</span>$</p>
<p>Without seeing the lastest competition result, we are looking forward to the <strong>expected frequency</strong> to be
$<span class="math notranslate nohighlight">\(
e_1 = 500\times 24\% = 120\\
e_2 = 500\times 40\% = 200\\
e_3 = 500\times 36\% = 180
\)</span>$</p>
<p>And here’s the comparison bar chart.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Marksman 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Marksman 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Marksman 3&#39;</span><span class="p">]</span>
<span class="n">post_training</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">142</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">172</span><span class="p">])</span>
<span class="n">exp_frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">120</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>  <span class="c1"># the label locations</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">.2</span>  <span class="c1"># the width of the bars</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">rects1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">post_training</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Post-Training&#39;</span><span class="p">)</span>
<span class="n">rects2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">exp_frequency</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exp. Freq.&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Scores&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Scores of Exp. Freq. And Post-Training&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/05-ANOVA_37_0.png" src="../_images/05-ANOVA_37_0.png" />
</div>
</div>
<p>If the expected and observed frequencies differ significantly, we would conclude a rejection to the null hypothesis. The test statistic is
$<span class="math notranslate nohighlight">\(
\chi^2=\sum_{i=1}^k\frac{(f_i-e_i)^2}{e_i}
\)</span><span class="math notranslate nohighlight">\(
where \)</span>f_i<span class="math notranslate nohighlight">\( and \)</span>e_i<span class="math notranslate nohighlight">\( are observed and expected frequencies. In this example, \)</span>\chi^2<span class="math notranslate nohighlight">\( is
\)</span><span class="math notranslate nohighlight">\(
\chi^2 = \frac{(f_1-e_1)^2}{e_1}+\frac{(f_2-e_2)^2}{e_2}+\frac{(f_3-e_3)^2}{e_3}
\)</span>$</p>
<p>Compute the <span class="math notranslate nohighlight">\(\chi^2\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">sum</span><span class="p">((</span><span class="n">post_training</span> <span class="o">-</span> <span class="n">exp_frequency</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">exp_frequency</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.233888888888888
</pre></div>
</div>
</div>
</div>
<p>Degree of freedom is <span class="math notranslate nohighlight">\(\nu=k-1=2\)</span>, therefore the rejection region is
$<span class="math notranslate nohighlight">\(
\chi^2&gt;\chi^2_{.05, 2}
\)</span>$
which can be found by <code class="docutils literal notranslate"><span class="pre">stats.chi2.ppf</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.991464547107979
</pre></div>
</div>
</div>
</div>
<p>Because <span class="math notranslate nohighlight">\(\chi^2\)</span>-statistic did not surpass the critical value, we conclude a fail to rejection of null hypothesis. That means even though the post-traning result is better than expectation, it’s likely to be a statistical fluke rather than evidence of skill improvement.</p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./basics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="04-Hypothesis-Testing.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Hypothesis Testing</p>
            </div>
        </a>
    </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By integzz<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>
